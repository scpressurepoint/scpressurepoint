<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Survey | Peak Pressure Washing Co.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0ea5e9',
                        secondary: '#38bdf8',
                        dark: '#0f172a',
                        darker: '#020617',
                        accent: '#06b6d4',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #020617 0%, #0f172a 50%, #1e293b 100%);
        }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(56, 189, 248, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .form-input {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(56, 189, 248, 0.2);
            color: #f8fafc;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .signature-pad {
            border: 2px dashed rgba(56, 189, 248, 0.3);
            background: rgba(30, 41, 59, 0.3);
            cursor: crosshair;
            border-radius: 8px;
            touch-action: none;
        }

        .signature-pad.drawing {
            border-color: #0ea5e9;
            border-style: solid;
        }

        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star {
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.active {
            color: #fbbf24;
        }

        .star:hover {
            color: #fbbf24;
        }

        .text-gradient {
            background: linear-gradient(135deg, #0ea5e9, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .success-message.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- Header/Navigation -->
    <header class="bg-darker py-4 px-6 md:px-12 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <span class="text-gradient font-bold text-xl">Peak Pressure</span>
                <span class="ml-2 text-white font-bold text-xl">Washing</span>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="index.html" class="text-gray-300 hover:text-primary transition">Home</a>
                <a href="index.html#services" class="text-gray-300 hover:text-primary transition">Services</a>
                <a href="index.html#contact" class="text-gray-300 hover:text-primary transition">Contact</a>
            </nav>
            <button class="md:hidden text-white focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Survey Section -->
    <section class="hero-gradient min-h-screen py-12">
        <div class="container mx-auto px-6">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="mb-6 inline-block">
                        <svg class="w-16 h-16 mx-auto text-primary" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-4 text-white">Customer Feedback Survey</h1>
                    <p class="text-lg text-gray-300">Help us improve our service by sharing your experience with Peak Pressure Washing Co.</p>
                </div>

                <!-- Survey Form -->
                <div class="glass-card p-8 rounded-xl">
                    <form id="surveyForm" class="space-y-8">
                        <!-- Customer Information -->
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Full Name *</label>
                                <input type="text" name="name" id="customer_name" required class="form-input w-full px-4 py-3 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Email Address *</label>
                                <input type="email" name="email" id="customer_email" required class="form-input w-full px-4 py-3 rounded-lg">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Phone Number</label>
                                <input type="tel" name="phone" id="customer_phone" class="form-input w-full px-4 py-3 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Service Date</label>
                                <input type="date" name="service_date" id="service_date" class="form-input w-full px-4 py-3 rounded-lg">
                            </div>
                        </div>
                        <div class="grid md:grid-cols-1 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Home Address *</label>
                                <input type="text" name="address" id="customer_address" class="form-input w-full px-4 py-3 rounded-lg bg-darker border border-primary border-opacity-30 focus:outline-none focus:ring-2 focus:ring-primary text-white" placeholder="123 Main Street, Columbia, SC 29201" required>
                            </div>
                        </div>
                        
                        <!-- Service Type -->
                        <div>
                            <label class="block text-sm font-medium mb-3 text-gray-300">Service Type *</label>
                            <div class="grid md:grid-cols-2 gap-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="service_type" value="House Washing" class="mr-3 text-primary">
                                    <span>Sidewalk Cleaning</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="service_type" value="Driveway Cleaning" class="mr-3 text-primary">
                                    <span>Driveway Cleaning</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="service_type" value="Deck/Patio Cleaning" class="mr-3 text-primary">
                                    <span>Deck/Patio Cleaning</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="service_type" value="Roof Cleaning" class="mr-3 text-primary">
                                    <span>Steps Cleaning</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="service_type" value="Other" class="mr-3 text-primary">
                                    <span>Other</span>
                                </label>
                            </div>
                        </div>

                        <!-- Overall Satisfaction -->
                        <div>
                            <label class="block text-sm font-medium mb-4 text-gray-300">Overall Satisfaction *</label>
                            <div class="star-rating" data-rating="0" data-field="overall">
                                <span class="star" data-value="1">★</span>
                                <span class="star" data-value="2">★</span>
                                <span class="star" data-value="3">★</span>
                                <span class="star" data-value="4">★</span>
                                <span class="star" data-value="5">★</span>
                            </div>
                            <p class="text-sm text-gray-400 mt-2">Click to rate from 1 (poor) to 5 (excellent)</p>
                        </div>

                        <!-- Quality Ratings -->
                        <div class="space-y-6">
                            <h3 class="text-lg font-semibold text-secondary">Please rate the following aspects:</h3>
                            
                            <div class="grid gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-300">Quality of Work</label>
                                    <div class="star-rating" data-rating="0" data-field="quality">
                                        <span class="star" data-value="1">★</span>
                                        <span class="star" data-value="2">★</span>
                                        <span class="star" data-value="3">★</span>
                                        <span class="star" data-value="4">★</span>
                                        <span class="star" data-value="5">★</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-300">Timeliness/Punctuality</label>
                                    <div class="star-rating" data-rating="0" data-field="timeliness">
                                        <span class="star" data-value="1">★</span>
                                        <span class="star" data-value="2">★</span>
                                        <span class="star" data-value="3">★</span>
                                        <span class="star" data-value="4">★</span>
                                        <span class="star" data-value="5">★</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-300">Professionalism</label>
                                    <div class="star-rating" data-rating="0" data-field="professionalism">
                                        <span class="star" data-value="1">★</span>
                                        <span class="star" data-value="2">★</span>
                                        <span class="star" data-value="3">★</span>
                                        <span class="star" data-value="4">★</span>
                                        <span class="star" data-value="5">★</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-300">Communication</label>
                                    <div class="star-rating" data-rating="0" data-field="communication">
                                        <span class="star" data-value="1">★</span>
                                        <span class="star" data-value="2">★</span>
                                        <span class="star" data-value="3">★</span>
                                        <span class="star" data-value="4">★</span>
                                        <span class="star" data-value="5">★</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recommendation -->
                        <div>
                            <label class="block text-sm font-medium mb-4 text-gray-300">Would you recommend our services to others? *</label>
                            <div class="flex gap-6">
                                <label class="flex items-center">
                                    <input type="radio" name="recommend" value="Yes" required class="mr-3 text-primary">
                                    <span>Yes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="recommend" value="No" required class="mr-3 text-primary">
                                    <span>No</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="recommend" value="Maybe" required class="mr-3 text-primary">
                                    <span>Maybe</span>
                                </label>
                            </div>
                        </div>

                        <!-- Additional Comments -->
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Additional Comments or Suggestions</label>
                            <textarea name="comments" id="customer_comments" rows="4" class="form-input w-full px-4 py-3 rounded-lg resize-vertical" placeholder="Please share any additional feedback, suggestions for improvement, or compliments..."></textarea>
                        </div>

                        <!-- Photo Consent Section -->
                        <div class="border-t border-gray-700 pt-8">
                            <h3 class="text-xl font-semibold text-secondary mb-6">Photo Usage Consent</h3>
                            
                            <div class="bg-darker/50 p-6 rounded-lg mb-6">
                                <h4 class="font-semibold text-white mb-3">Permission to Use Photos</h4>
                                <p class="text-gray-300 text-sm leading-relaxed mb-4">
                                    Peak Pressure Washing Co. would like permission to use before/after photos of your property 
                                    for marketing purposes, including our website, social media, and promotional materials. 
                                    Your personal information will never be shared, and photos will only showcase our work quality.
                                </p>
                                <div class="flex items-start gap-3">
                                    <input type="checkbox" id="photo_consent" name="photo_consent" value="Yes" class="mt-1">
                                    <label for="photo_consent" class="text-sm text-gray-300">
                                        I give Peak Pressure Washing Co. permission to use photos of my property for marketing purposes.
                                    </label>
                                </div>
                            </div>

                            <!-- Signature Pad -->
                            <div id="signature-section" class="hidden">
                                <label class="block text-sm font-medium mb-3 text-gray-300">Digital Signature *</label>
                                <div class="bg-darker/30 p-4 rounded-lg">
                                    <canvas id="signaturePad" width="600" height="200" class="signature-pad w-full mb-4"></canvas>
                                    <div class="flex justify-between items-center">
                                        <p class="text-xs text-gray-400">Please sign above to confirm your consent</p>
                                        <button type="button" id="clearSignature" class="text-sm text-primary hover:text-secondary transition">
                                            <i class="fas fa-eraser mr-1"></i> Clear
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center pt-6">
                            <button type="submit" class="bg-primary hover:bg-primary/90 text-white font-medium py-4 px-12 rounded-lg transition duration-300 flex items-center justify-center mx-auto">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Submit Survey
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Message -->
    <div id="successMessage" class="success-message">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Thank you! Your survey has been submitted successfully.</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-darker border-t border-gray-800 pt-12 pb-8 px-6">
        <div class="container mx-auto text-center">
            <div class="flex items-center justify-center space-x-3 mb-4">
                <span class="text-gradient font-bold">Peak Pressure</span>
                <span class="text-white font-bold">Washing</span>
            </div>
            <p class="text-gray-400">Local pressure washing services in Columbia, SC</p>
            <p class="text-gray-500 text-sm mt-4">&copy; 2025 Peak Pressure Washing Co. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Initialize EmailJS
        emailjs.init("dBgVOO8qy6W9xDg1m");

        // Star rating functionality
        document.querySelectorAll('.star-rating').forEach(rating => {
            const stars = rating.querySelectorAll('.star');
            let currentRating = 0;

            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    currentRating = index + 1;
                    rating.dataset.rating = currentRating;
                    updateStars(stars, currentRating);
                });

                star.addEventListener('mouseover', () => {
                    updateStars(stars, index + 1);
                });
            });

            rating.addEventListener('mouseleave', () => {
                updateStars(stars, currentRating);
            });
        });

        function updateStars(stars, rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // Photo consent checkbox functionality
        const photoConsent = document.getElementById('photo_consent');
        const signatureSection = document.getElementById('signature-section');

        photoConsent.addEventListener('change', () => {
            if (photoConsent.checked) {
                signatureSection.classList.remove('hidden');
                setTimeout(initializeCanvas, 100);
            } else {
                signatureSection.classList.add('hidden');
                if (typeof clearCanvas === 'function') {
                    clearCanvas();
                }
            }
        });

        // Signature pad functionality
        let canvas, ctx, drawing = false, hasSignature = false;

        function initializeCanvas() {
            canvas = document.getElementById('signaturePad');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 200;
            
            ctx.strokeStyle = '#0ea5e9';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            setupCanvasEvents();
        }

        function setupCanvasEvents() {
            if (!canvas) return;

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            canvas.addEventListener('touchstart', e => e.preventDefault());
            canvas.addEventListener('touchend', e => e.preventDefault());
            canvas.addEventListener('touchmove', e => e.preventDefault());
        }

        function getEventPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawing(e) {
            drawing = true;
            hasSignature = true;
            canvas.classList.add('drawing');
            
            const pos = getEventPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!drawing) return;
            e.preventDefault();
            
            const pos = getEventPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (drawing) {
                drawing = false;
                canvas.classList.remove('drawing');
                ctx.beginPath();
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent({
                touchstart: 'mousedown',
                touchmove: 'mousemove',
                touchend: 'mouseup'
            }[e.type], {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            if (ctx) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                hasSignature = false;
            }
        }

        document.getElementById('clearSignature').addEventListener('click', clearCanvas);

        // Form submission
        document.getElementById('surveyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate required fields
            const name = document.getElementById('customer_name').value.trim();
            const email = document.getElementById('customer_email').value.trim();
            const address = document.getElementById('customer_address').value.trim();
            const overallRating = document.querySelector('.star-rating[data-field="overall"]').dataset.rating;
            const recommend = document.querySelector('input[name="recommend"]:checked');

            if (!name || !email || !address) {
                alert('Please fill in all required fields (Name, Email, Address).');
                return;
            }

            if (overallRating === '0') {
                alert('Please provide an overall satisfaction rating.');
                return;
            }

            if (!recommend) {
                alert('Please indicate if you would recommend our services.');
                return;
            }

            // Check signature if photo consent is given
            if (photoConsent.checked && !hasSignature) {
                alert('Please provide your signature to confirm photo consent.');
                return;
            }

            // Show loading state
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
            submitButton.disabled = true;

            // Gather all form data
            const formData = gatherFormData();

            // Submit to both services
            Promise.all([
                submitToFormSubmit(formData),
                sendCustomerConfirmation(formData)
            ])
            .then(() => {
                console.log('Both submissions successful');
                
                // Show success message
                showSuccessMessage();
                
                // Reset form
                resetForm();
                
                // Redirect after delay
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error submitting your survey. Please try again or contact us directly.');
            })
            .finally(() => {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            });
        });

        function gatherFormData() {
            // Get service types
            const serviceTypes = [];
            document.querySelectorAll('input[name="service_type"]:checked').forEach(checkbox => {
                serviceTypes.push(checkbox.value);
            });

            // Get ratings
            const overallRating = document.querySelector('.star-rating[data-field="overall"]').dataset.rating;
            const qualityRating = document.querySelector('.star-rating[data-field="quality"]').dataset.rating;
            const timelinessRating = document.querySelector('.star-rating[data-field="timeliness"]').dataset.rating;
            const professionalismRating = document.querySelector('.star-rating[data-field="professionalism"]').dataset.rating;
            const communicationRating = document.querySelector('.star-rating[data-field="communication"]').dataset.rating;

            // Get signature data
            let signatureData = '';
            if (hasSignature && canvas) {
                signatureData = canvas.toDataURL();
            }

            return {
                name: document.getElementById('customer_name').value.trim(),
                email: document.getElementById('customer_email').value.trim(),
                phone: document.getElementById('customer_phone').value.trim() || 'Not provided',
                address: document.getElementById('customer_address').value.trim(),
                service_date: document.getElementById('service_date').value || 'Not specified',
                service_types: serviceTypes.join(', ') || 'Not specified',
                overall_rating: overallRating,
                quality_rating: qualityRating,
                timeliness_rating: timelinessRating,
                professionalism_rating: professionalismRating,
                communication_rating: communicationRating,
                recommend: document.querySelector('input[name="recommend"]:checked').value,
                comments: document.getElementById('customer_comments').value.trim() || 'No additional comments',
                photo_consent: photoConsent.checked ? 'Yes' : 'No',
                signature_data: signatureData
            };
        }

        function submitToFormSubmit(data) {
            const formData = new FormData();
            
            // Add all the data with proper formatting
            formData.append('customer_name', data.name);
            formData.append('customer_email', data.email);
            formData.append('customer_phone', data.phone);
            formData.append('customer_address', data.address);
            formData.append('service_date', data.service_date);
            formData.append('service_types', data.service_types);
            formData.append('overall_rating', data.overall_rating + '/5 stars');
            formData.append('quality_rating', data.quality_rating + '/5 stars');
            formData.append('timeliness_rating', data.timeliness_rating + '/5 stars');
            formData.append('professionalism_rating', data.professionalism_rating + '/5 stars');
            formData.append('communication_rating', data.communication_rating + '/5 stars');
            formData.append('recommendation', data.recommend);
            formData.append('customer_comments', data.comments);
            formData.append('photo_consent', data.photo_consent + (data.signature_data ? ' - Digital signature provided' : ''));

            // Handle signature
            if (data.signature_data) {
                try {
                    const base64Data = data.signature_data.split(',')[1];
                    const byteCharacters = atob(base64Data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: 'image/png' });
                    
                    const customerName = data.name.replace(/[^a-zA-Z0-9]/g, '_');
                    const filename = `signature_${customerName}_${Date.now()}.png`;
                    formData.append('signature_file', blob, filename);
                } catch (error) {
                    console.error('Error processing signature:', error);
                }
            }

            // FormSubmit configuration
            formData.append('_subject', 'New Customer Survey Submission - Peak Pressure Washing');
            formData.append('_captcha', 'false');
            formData.append('_template', 'table');

            return fetch('https://formsubmit.co/scpressurewashing2025@gmail.com', {
                method: 'POST',
                body: formData
            });
        }

        function sendCustomerConfirmation(data) {
            // Create ratings summary for the template
            const ratingsText = `Overall Satisfaction: ${data.overall_rating}/5 stars
Quality of Work: ${data.quality_rating}/5 stars  
Timeliness: ${data.timeliness_rating}/5 stars
Professionalism: ${data.professionalism_rating}/5 stars
Communication: ${data.communication_rating}/5 stars`;

            // Prepare template parameters that match your EmailJS template exactly
            const templateParams = {
                customer_name: data.name,
                customer_email: data.email,
                service_types: data.service_types,
                service_date: data.service_date,
                overall_rating: data.overall_rating + '/5 stars',
                ratings_summary: ratingsText,
                recommendation: data.recommend,
                comments: data.comments,
                photo_consent: data.photo_consent,
                email: data.email  // for reply-to field
            };

            return emailjs.send(
                'service_8l948h6',
                'template_34hy29781',
                templateParams,
                'dBgVOO8qy6W9xDg1m'
            );
        }

        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('show');
            
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 3000);
        }

        function resetForm() {
            document.getElementById('surveyForm').reset();
            
            // Reset star ratings
            document.querySelectorAll('.star-rating').forEach(rating => {
                rating.dataset.rating = '0';
                updateStars(rating.querySelectorAll('.star'), 0);
            });
            
            // Reset signature
            if (canvas) {
                clearCanvas();
            }
            
            signatureSection.classList.add('hidden');
            photoConsent.checked = false;
        }
    </script>
</body>
</html>
